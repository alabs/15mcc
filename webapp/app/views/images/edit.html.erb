<% @title = "Edición de la foto" %>

<div class="row margin">
  <div class="span9">
<div class="form-stacked main-form">
<%= form_for(@image, :html => { :multipart => true }) do |f| %>
  <fieldset>
    <legend>Editar foto</legend>
      <%= render :partial => "partials/copyright_notice" %>
      <% if @image.errors.any? %>
        <% @image.errors.full_messages.each do |msg| %>
          <div class="alert alert-error"><%= msg %></div>
        <% end %>
      <% end %>
    <div class="form-field">
      <%= f.text_field :title, required: true, placeholder: 'Título de la imágen', :class => 'span8' do %>
        <p class="help-block"><%= I18n.t("help.image.title") %></p>
      <% end %>
    </div>

    <div class="form-field">
      <%= f.file_field :img, class: 'upload' %>
        <p class="help-block"><%= I18n.t("help.image.archive") %></p>
    </div>
    
    <% if user_signed_in? %>
      <%= f.check_box :author_myself, :class => "author_myself" do %>
        <%= I18n.t("help.content.author.myself") %>
      <% end %>
    <% end %>
    <div class="form-field author-field">
      <%= f.text_field :author_name, class: 'span8', :required => "true"  do %>
        <p class="help-block"><%= I18n.t("help.content.author.name") %></p>
      <% end %>
    </div>
    <div class="form-field author-field">
      <%= f.text_field :author_link, class: 'span8', :type => "url" do %>
        <p class="help-block"><%= I18n.t("help.content.author.url") %></p>
      <% end %>
    </div>

    <div class="form-field">
      <%= f.text_field :tag_list, class: 'span8', :required => 'true' do %>
        <p class="help-block"><%= I18n.t("help.content.tags") %></p>
      <% end %>
    </div>

    <% if current_user.blank? %>

      <div class="alert alert-info">
        No te has registrado, por lo que tendrás que confirmar que eres un humano completando las palabras que ves más abajo en el cuadro. Si no quieres tener que hacer esto cada vez que subas algo tendrás que <%= link_to "registrarte", new_user_registration_path %> o sí ya tienes un usuario <%= link_to "iniciar sesión", new_user_session_path %>.
      </div>

      <%= recaptcha_tags %>

    <% end %>
    
    <div class="form-field">
      <%= f.text_field :happened_at, placeholder: '¿Cuándo ha ocurrido?', :class => 'span8' do %>
        <p class="help-block"><%= I18n.t("help.content.time") %></p>
      <% end %>
    </div>
    
    <legend> ¿Dónde ha ocurrido? </legend>
      <div class="form-field">
        <%= f.text_field :address, placeholder: 'Ejemplo: Plaza de Puerta del Sol', :id => 'map-address', :class => 'span7' do %>
        <p class="help-block"><%= I18n.t("help.content.location.address") %></p>
      <% end %>

        <%= f.text_field :city, placeholder: 'Ejemplo: Madrid', :id => 'map-city', :class => 'span7', :required => true do %>
        <p class="help-block"><%= I18n.t("help.content.location.city") %></p>
      <% end %>

        <%= f.text_field :country, placeholder: 'Ejemplo: España', :id => 'map-country', :class => 'span7', :required => true do %>
        <p class="help-block"><%= I18n.t("help.content.location.country") %></p>
      <% end %>
          <a href="#" id="map-search" class="btn">
            <i class='icon-search'></i>
            Buscar
          </a>


      <div class="hide">
        <%= f.text_field :latitude, :class => 'location_attributes_latitude', :style => "display:none" %>
        <%= f.text_field :longitude, :class => 'location_attributes_longitude', :style => "display:none" %>
      </div>

      </div>
      <% if @map == "[]" %>
        <%= gmaps("map_options" => {"center_longitude" => -3.700, "center_latitude" => 40.41, "zoom" => 3, "auto_adjust" => false, "auto_zoom" => false},"markers" => { "data" => @map }) %>
      <% else %>
        <%= gmaps("map_options" => {"auto_adjust" => true, "zoom" => 4, "auto_zoom" => false},"markers" => { "data" => @map }) %>
      <% end %>

    <div class="form-actions">
      <%= f.submit 'Enviar imágen', :class => 'btn primary' %>
      <%= link_to 'Cancelar', images_path, :class => 'btn danger' %>
    </div>
  </fieldset>
<% end %>
</div>

</div>
</div>
